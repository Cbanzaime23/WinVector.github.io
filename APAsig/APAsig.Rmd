---
title: "APASig"
author: "Win-Vector LLC"
date: "October 2, 2016"
output: html_document
---

```{r fns}

# Format quality of a linear regerssion in
# roughly in "APA Style" ( American Psychological Association ).
# see: http://my.ilstu.edu/~jhkahn/apastats.html
#      https://web2.uconn.edu/writingcenter/pdf/Reporting_Statistics.pdf
# Not linking direclty to the style guide as they charge for it.
#
formatAPAR2 <- function(R2,FValue,numdf,dendf,
                                        pCutOff=1.0e-5) {
  pValue <-  stats::pf(FValue,
                       numdf, 
                       dendf,
                       lower.tail=FALSE)
  if(pValue<pCutOff) {
    pString <- paste0('<i>p</i>&lt;',sprintf('%.3g',pCutOff))
  } else {
    pString <- paste0('<i>p</i>&le;',sprintf('%.3g',pValue))
  }
  paste0('<b>F Test</b> summary: (<i>R</i><sup>2</sup>=',sprintf('%.2g',R2),
         ', <i>F</i>(',numdf,',',dendf,')=',
         sprintf('%g',FValue),
         ', ',pString,').')
}

# Format from model.
formatLinearRegressionModelAPAR2 <- function(linearRegressionModel,
                                             pCutOff=1.0e-5) {
  fitSummary <- summary(linearRegressionModel)
  fstats <- fitSummary$fstatistic
  FValue <- fstats[['value']]
  numdf <-  fstats[['numdf']]
  dendf <- fstats[['dendf']]
  R2 <- fitSummary$r.squared
  formatAPAR2(R2,FValue,numdf,dendf,pCutOff)
}

# Format from data.
formatLinearRegressionFitAPAR2 <- function(predictions,y,nParameters,
                                           meany=mean(y),
                                           pCutOff=1.0e-5) {
  n <- length(y)
  rss1 <- sum((y-meany)^2)
  rss2 <- sum((y-predictions)^2)
  p1 <- 1
  p2 <- 1 + nParameters
  FValue = ((rss1-rss2)/(p2-p1))/(rss2/(n-p2))
  R2 <- 1 - rss2/rss1
  formatAPAR2(R2,FValue,p2-p1,n-p2,pCutOff)
}
```

Example showing we can get the items reported by `summary(model)` into one
well-behaved string.

```{r demo}
d <- data.frame(x=1:8)
d$y <- d$x^2
model <- lm(y~x,data=d)

print(summary(model))
```

```{r results='asis'}
cat(formatLinearRegressionModelAPAR2(model))
```

```{r results='asis'}
cat(formatLinearRegressionFitAPAR2(predictions=predict(model,newdata=d),y=d$y,
                               nParameters=1,meany=mean(d$y)))
```

